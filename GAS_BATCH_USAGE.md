# HALLEL渋谷 GAS バッチ処理 使用方法

## 修正内容
700件以上のメールでも実行時間制限にかからずに処理できるよう、バッチ処理機能を追加しました。

## 主な変更点

1. **バッチサイズ制限**: 一度に50件ずつ処理
2. **実行時間監視**: 5分以内で自動的に次のバッチをスケジュール
3. **自動継続処理**: 1分後に次のバッチを自動実行
4. **進行状況管理**: どこまで処理したかを追跡

## 利用可能な関数

### メイン実行関数
- `syncGmailReservations()` - 通常の同期開始（推奨）
- `forceFullSync()` - 強制全件処理（大きなバッチで実行）

### 管理関数
- `checkProgress()` - 現在の進行状況を確認
- `resetBatchProgress()` - バッチ処理をリセット
- `testSync()` - 小規模テスト（10件のみ）

### トリガー管理
- `setupTrigger()` - 定期実行トリガー設定
- `continueProcessing()` - バッチ処理続行（自動実行用）

## 使用方法

### 1. 通常の全件処理
```javascript
syncGmailReservations()
```
- 50件ずつバッチ処理
- 実行時間制限に近づくと自動的に次のバッチをスケジュール

### 2. 進行状況確認
```javascript
checkProgress()
```
- 現在どこまで処理したかを確認

### 3. 処理リセット
```javascript
resetBatchProgress()
```
- バッチ処理を最初からやり直したい場合

### 4. テスト実行
```javascript
testSync()
```
- 10件のみ処理してテスト

## 実行ログの見方

```
📧 バッチ処理開始 - インデックス: 0
📊 全メール数: 751件
📦 バッチ処理: 1〜50件目 (50件)
⏳ 処理中... (1/751)
✅ 予約処理: 2025-12-16 20:00-21:00 佐々木 智也
📈 進行状況: 10/751 (1%)
...
📅 次のバッチをスケジュール: 50〜
```

## トラブルシューティング

### 処理が途中で止まった場合
1. `checkProgress()` で現在の状況を確認
2. 必要に応じて `resetBatchProgress()` でリセット
3. `syncGmailReservations()` で再開

### エラーが発生した場合
- 個別のメールエラーは処理を続行
- 重大なエラーの場合は `resetBatchProgress()` でリセット

## 設定調整

```javascript
const CONFIG = {
  BATCH_SIZE: 50,           // バッチサイズ（調整可能）
  MAX_EXECUTION_TIME: 300000, // 5分（調整可能）
  // ...
};
```

バッチサイズや実行時間制限は必要に応じて調整できます。