#!/usr/bin/env python3
from reservation_classifier import HALLELReservationClassifier

# ストア別フィルタリングテスト用のメールデータ
test_emails = [
    # 渋谷店の予約完了メール（処理対象）
    ("hallel 予約完了", """辻 克哉 様

ご予約ありがとうございます。

以下の内容を承りましたのでご確認ください。

--------------------------------------------------------------------

日時：2025年11月16日(日) 10:00~11:00

店舗： HALLEL 渋谷店

ルーム： 【STUDIO】利用 60分

設備： 渋谷店 STUDIO ⑥ (1)

スタッフ：

プログラム：【STUDIO】利用 60分

--------------------------------------------------------------------"""),

    # 半蔵門店の予約完了メール（除外対象）
    ("hallel 予約完了", """田中 太郎 様

ご予約ありがとうございます。

以下の内容を承りましたのでご確認ください。

--------------------------------------------------------------------

日時：2025年11月16日(日) 14:00~15:00

店舗： HALLEL 半蔵門店

ルーム： 【STUDIO】利用 60分

設備： 半蔵門店 STUDIO ② (1)

スタッフ：

プログラム：【STUDIO】利用 60分

--------------------------------------------------------------------"""),

    # 渋谷店のキャンセルメール（処理対象）
    ("hallel 予約キャンセル", """山田 花子 様

以下の予約をキャンセルいたしました。

--------------------------------------------------------------------

日時：2025年11月17日(月) 09:00~10:00

店舗： HALLEL 渋谷店

ルーム： 【STUDIO】利用 60分

--------------------------------------------------------------------"""),

    # 半蔵門店のキャンセルメール（除外対象）
    ("hallel 予約キャンセル", """佐藤 次郎 様

以下の予約をキャンセルいたしました。

--------------------------------------------------------------------

日時：2025年11月17日(月) 16:00~17:00

店舗： HALLEL 半蔵門店

ルーム： 【STUDIO】利用 60分

--------------------------------------------------------------------"""),

    # 店舗情報が不明なメール（除外対象）
    ("hallel 予約完了", """鈴木 一郎 様

ご予約ありがとうございます。

日時：2025年11月18日(火) 12:00~13:00
ルーム： STUDIO利用
""")
]

def main():
    classifier = HALLELReservationClassifier()
    print("🏪 HALLEL店舗別フィルタリング テスト")
    print("=" * 50)

    for i, (subject, body) in enumerate(test_emails, 1):
        print(f"\n=== テストメール {i} ===")

        # 店舗判定を表示
        if "渋谷店" in body:
            expected = "🟢 渋谷店（処理対象）"
        elif "半蔵門店" in body:
            expected = "🔴 半蔵門店（除外対象）"
        else:
            expected = "⚪ 店舗不明（除外対象）"

        print(f"期待結果: {expected}")

        # 分類実行
        result = classifier.classify_email(subject, body)

        if result:
            print(f"実際結果: ✅ 処理された")
            print(f"  アクション: {result.action_type}")
            print(f"  日時: {result.date} {result.start_time}-{result.end_time}")
            print(f"  顧客: {result.customer_name}")
            print(f"  信頼度: {result.confidence:.2f}")
        else:
            print(f"実際結果: ❌ 除外された")

        # 判定結果の確認
        if "渋谷店" in body and result:
            print("判定: ✅ 正解")
        elif ("半蔵門店" in body or "店舗： HALLEL 半蔵門店" not in body and "店舗： HALLEL 渋谷店" not in body) and not result:
            print("判定: ✅ 正解")
        else:
            print("判定: ❌ 誤判定")

if __name__ == "__main__":
    main()